{% extends 'main/base.html' %}
{% load static %}

{% block references %}
<link type="text/css" href="{% static 'css/posts.css' %}" rel="stylesheet" />
{% endblock %}

{% block content %}
<div id="main" class="container" >
	{% if messages %}
	<div class="row">
		{% for message in messages %}
		<div class="col-12"><div class="box message {% if message.tags %} {{ message.tags }}"{% endif %}>{{ message }}</div></div>
		{% endfor %}
	</div>
	{% endif %}

	<div class="row" style="height:100%">
		{% if user.is_authenticated %}
		<div id="posts" class="col-12 col-md-8">
			<!-- <button class="btn btn-primary" onclick="getFriends()">Find Friends on Tag</button> -->
			<div id="compose" class="box">
				<form method="post" action="{% url 'submit-post' %}">
				 {% csrf_token %}
					<div class="input-group">
						<textarea maxlength="5000" name='body' class="form-control custom-control autoExpand" id="compose-box" rows="1" placeholder="What's on your mind?" style="resize:none"></textarea>
						<button class="input-group-addon btn btn-primary" type="submit" style="border-radius: 0px">post</button>
					</div>
				</form>
			</div>
			{% include 'main/modules/posts.html' %}
			<div class="box">
				<div class="box-header">
					Your friend posted...
					<div class="float-right" style="font-size:1.3em;">
						200 <i class="fas fa-arrow-circle-up fa-lg like-button" onclick="like()" style="margin-left:5px"></i>
					</div>
				</div>
				<hr>
				This is not a real post; it is a hard-coded example of what a post with comments might look like.
				<hr>
				<div class="post-comments">
					<img src="{% static "img/headshot.png" %}">
					This is a test comment where I also attempt to tag <span class="tag">my friend</span>
				</div>
			</div>
		</div>
		<div class="d-none d-sm-block col-md-4" style="padding:0px;">
			<div id="sidebar">
				<div class="box">
					<h1> Suggested Friends </h1>
					<hr>
					{% if suggested_friends|length == 0 %}
					<div class="suggested-item">
						Facebook friends on Tag will appear here.
					</div>
					{% endif %}

					{% for friend in suggested_friends %}
					<div class="suggested-item">
						<table width="100%">
							<tr>
								<td width="5%">
									<img src="{{ friend.avatar.url }}">
								</td>
								<td width="95%">
									{{ friend.first_name }} {{ friend.last_name }}
								</td>
								<td>
									<form class="float-right" role="form" style="font-size: 5px; padding-right:0px" method="post" action="{% url 'send-request' friend.pk %}">
										{% csrf_token %}
										<button class="float-right btn btn-outline-notifications btn-sm" type="submit">Send</button>
									</form>
								</td>
							</td>
						</table>
					</div>
					<hr>
					{% endfor %}
				</div>

				<div class="box">
					<h1> Suggested Groups </h1>
					
					<hr>
					{% if suggested_groups.count == 0 %}
					<div class="suggested-item">
						Groups that your friends are in will appear here.
					</div>
					{% endif %}
					{% for group in suggested_groups %}
						<div class="suggested-item">
							<table width="100%">
								<tr>
									<td width="5%">
										<img src="{{ group.photo.url }}">
									</td>
									<td width="90%">
										{{ group.name }}
									</td>
									<td>
										<form class="btn-group float-right" role="group" method="post" action="{% url 'join-group' group.pk %}" style="font-size: 5px; padding-right:0px;">
											<button class="btn btn-outline-notifications btn-sm" type="submit">Join</button>
										</form>
									</td>
								</tr>
							</table>
						</div>

					{% endfor %}
				</div>
			</div>
		</div>
	</div>
	{% else %}
	<div class="col-12">
		<div class="box message">
			Welcome to tag! Since you're not logged in, you can't see a personalized feed of anonymous posts. You can search for and look at groups without registering, but you cannot add friends or subscribe to groups. 

			To have the best tag@mit experience, please log in with Facebook.
		</div>
	</div>
	{% endif %}
</div>
<!-- Settings Modal -->
<div class="modal fade" id="settings_overlay" tabindex="-1" role="dialog" aria-labelledby="settingsModal" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 >Settings</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
				<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<form>
					<div class="form-group">
						<label for="exampleInputEmail1">Email address</label>
						<input type="email" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp" placeholder="Enter email">
						<small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone else.</small>
					</div>
					<div class="form-group">
						<label for="exampleInputPassword1">Password</label>
						<input type="password" class="form-control" id="exampleInputPassword1" placeholder="Password">
					</div>
					<div class="form-check">
						<input type="checkbox" class="form-check-input" id="exampleCheck1">
						<label class="form-check-label" for="exampleCheck1">Check me out</label>
					</div>
					<button type="submit" class="btn btn-primary">Submit</button>
				</form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
				<button type="button" class="btn btn-primary" onclick="saveSettings()" data-dismiss="modal">Save changes</button>
			</div>
		</div>
	</div>
</div>
{% if user.is_authenticated %}
	{% include 'main/modules/tag_modal.html' %}
{% endif %}
{% endblock %}

{% block javascript %}
{% if user.is_authenticated and not user.is_anonymous %}
<script src="{% static 'js/csrftoken.js' %}"></script>
<script>
	{% include 'main/modules/like_and_tag.js' %}
</script>
{% endif %}
{% endblock %}
